{% extends "main/base.html" %}
{% load static %}

{% block title %}{{ product.name }} - Sarac İhsan{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product-detail.css' %}">
{% endblock %}

{% block content %}
<main class="product-page">
    <!-- Breadcrumb -->
    <section class="breadcrumb-section">
        <div class="container">
            <nav class="breadcrumb">
                <a href="/">Ana Sayfa</a>
                <span class="breadcrumb-separator">/</span>
                <a href="{% url 'category_detail' product.category.slug %}">{{ product.category.name }}</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">{{ product.name }}</span>
            </nav>
        </div>
    </section>

    <!-- Product Detail -->
    <section class="product-detail-section">
        <div class="container">
            <div class="product-detail-grid">
                <!-- Product Image -->
                <div class="product-detail-image">
                    {% if product.get_image_url %}
                    <img src="{{ product.get_image_url }}" alt="{{ product.name }}" id="mainProductImage">
                    {% else %}
                    <div class="product-detail-placeholder">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </div>
                    {% endif %}
                </div>

                <!-- Product Info -->
                <div class="product-detail-info">
                    {% if product.is_featured %}
                    <span class="featured-badge-large">ÖNE ÇIKAN ÜRÜN</span>
                    {% endif %}
                    
                    <h1 class="product-detail-title">{{ product.name }}</h1>
                    
                    <div class="product-detail-meta">
                        <span class="product-category-badge">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 7h-4M8 7H4m16 0v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7m16 0V5a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v2"></path>
                            </svg>
                            {{ product.category.name }}
                        </span>
                    </div>

                    {% if product.description %}
                    <div class="product-detail-description">
                        <h3 class="description-title">Açıklama</h3>
                        <p class="description-text">{{ product.description }}</p>
                    </div>
                    {% endif %}

                    <div class="product-detail-actions">
                        <a href="#" class="btn btn-primary" id="addToCartButton" data-product-id="{{ product.id }}" data-product-name="{{ product.name }}" data-product-category="{{ product.category.name }}">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-8 2a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"></path>
                            </svg>
                            Sepete Ekle
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Products -->
    {% if related_products %}
    <section class="related-products-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Benzer Ürünler</h2>
                <p class="section-subtitle">Aynı kategoriden diğer ürünler</p>
            </div>
            <div class="related-products-grid">
                {% for related_product in related_products %}
                <article class="product-card-small">
                    <a href="{% url 'product_detail' related_product.slug %}" class="product-card-link">
                        <div class="product-card-image">
                            {% if related_product.get_image_url %}
                            <img src="{{ related_product.get_image_url }}" alt="{{ related_product.name }}" loading="lazy">
                            {% else %}
                            <div class="product-placeholder">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <polyline points="21 15 16 10 5 21"></polyline>
                                </svg>
                            </div>
                            {% endif %}
                        </div>
                        <div class="product-card-content">
                            <h3 class="product-card-title">{{ related_product.name }}</h3>
                        </div>
                    </a>
                </article>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

</main>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const addToCartButton = document.getElementById('addToCartButton');
    
    if (addToCartButton) {
        addToCartButton.addEventListener('click', function(e) {
            e.preventDefault();
            
            const productId = this.getAttribute('data-product-id');
            const productName = this.getAttribute('data-product-name');
            
            // Sepete ekle (AJAX)
            fetch('{% url "add_to_cart" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({
                    product_id: productId,
                    product_name: productName
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Sepet badge'ini güncelle
                    const cartBadge = document.getElementById('cartBadge');
                    if (cartBadge) {
                        cartBadge.textContent = data.cart_count;
                        cartBadge.style.display = data.cart_count > 0 ? 'flex' : 'none';
                    }
                    
                    // Başarı mesajı göster
                    alert('Ürün sepete eklendi!');
                } else {
                    alert('Bir hata oluştu: ' + (data.error || 'Bilinmeyen hata'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Bir hata oluştu. Lütfen tekrar deneyin.');
            });
        });
    }
});
</script>
{% endblock %}

